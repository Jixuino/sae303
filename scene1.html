<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Le Musée des Filières - Mobile</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

    <script>
      // --- 1. DÉTECTION DE PROXIMITÉ (Ton script original) ---
      AFRAME.registerComponent('distance-check', {
        schema: { threshold: {default: 10} },
        tick: function () {
          var camera = this.el.sceneEl.camera;
          if (!camera) return;
          // Note: On prend la position world du monde car la caméra est maintenant dans un rig
          var camPos = new THREE.Vector3();
          camera.el.object3D.getWorldPosition(camPos);
          
          var objPos = new THREE.Vector3();
          this.el.object3D.getWorldPosition(objPos);

          var distance = camPos.distanceTo(objPos);
          var hologram = this.el.querySelector('.hologram');
          
          if (hologram) {
            if (distance < this.data.threshold) {
              hologram.setAttribute('visible', 'true');
            } else {
              hologram.setAttribute('visible', 'false');
            }
          }
        }
      });

      // --- 2. SYSTÈME DE DÉPLACEMENT (Nouveau) ---
      AFRAME.registerComponent('move-on-click', {
        init: function () {
          this.el.addEventListener('click', (evt) => {
            // On récupère le "corps" du joueur (le rig)
            var rig = document.querySelector('#camera-rig');
            // La position cible (celle de la boule)
            var targetPos = this.el.getAttribute('position');
            
            // On veut aller à la position X/Z de la boule, mais garder la hauteur Y du rig (4.5)
            // Sinon on se retrouve la tête dans le sol
            var destination = {x: targetPos.x, y: 4.5, z: targetPos.z};

            // On lance l'animation de déplacement
            rig.setAttribute('animation', {
              property: 'position',
              to: destination.x + ' ' + destination.y + ' ' + destination.z,
              dur: 1500, // Durée en ms (1.5 secondes)
              easing: 'easeInOutQuad'
            });
          });
          
          // Petit effet quand on passe la souris/le viseur dessus
          this.el.addEventListener('mouseenter', () => {
            this.el.setAttribute('color', '#FFF'); // Devient blanc
            this.el.setAttribute('scale', '2.5 2.5 2.5');
          });
          this.el.addEventListener('mouseleave', () => {
            this.el.setAttribute('color', '#FFD700'); // Revient jaune
            this.el.setAttribute('scale', '2 2 2');
          });
        }
      });
    </script>

    <style>
      .bouton-retour {
        position: fixed; top: 20px; left: 20px; z-index: 1000;
        padding: 12px 24px; background-color: #333; color: white;
        text-decoration: none; font-family: sans-serif; border-radius: 8px; font-weight: bold; opacity: 0.9;
      }
      .bouton-retour:hover { background-color: #555; }
      .audio-hint {
        position: fixed; bottom: 20px; width: 100%; text-align: center;
        color: #aaa; font-family: sans-serif; pointer-events: none;
        text-shadow: 1px 1px 2px black;
      }
    </style>
</head>
<body>

    <a href="index.html" class="bouton-retour">⬅ Retour au menu</a>
    <div class="audio-hint">Visez les sphères jaunes et touchez l'écran pour avancer</div>

    <a-scene>

      <a-assets>
        <audio id="musique-ambiance" src="assets_scene1/leprintempsvivaldi.mp3" preload="auto"></audio>
        <audio id="sound-crowd" src="assets_scene1/brouhaha.mp3" preload="auto" loop="true"></audio>
        <a-asset-item id="galerie-model" src="assets_scene1/vr_gallery.glb"></a-asset-item>
        <a-image id="text-decoration" src="assets_scene1/texte1.png"></a-image>
      </a-assets>

      <a-entity light="type: ambient; intensity: 0.6; color: #FFF"></a-entity>
      <a-entity light="type: point; intensity: 0.5; distance: 30; decay: 2" position="0 5 5"></a-entity>
      <a-entity light="type: point; intensity: 0.5; distance: 30; decay: 2" position="0 5 -20"></a-entity>

      <a-gltf-model src="#galerie-model" position="0 0 -10" rotation="0 -90 0" scale="3 3 3"></a-gltf-model>
      <a-sound src="#musique-ambiance" autoplay="true" loop="true" volume="3" positional="false"></a-sound>
      <a-image src="#text-decoration" position="0 7 -33" rotation="0 0 0" width="14" height="6"></a-image>

      <a-entity id="camera-rig" position="0 4.5 8">
          
          <a-entity camera look-controls="pointerLockEnabled: false">
              <a-cursor position="0 0 -1" 
                        color="white" 
                        scale="0.5 0.5 0.5"
                        animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 0.5 0.5 0.5"
                        animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 0.5 0.5 0.5; to: 0.1 0.1 0.1">
              </a-cursor>
          </a-entity>

      </a-entity>

      <a-sphere position="0 3.5 8" radius="5" color="#FFD700" move-on-click animation="property: position; to: 0 4 8; dir: alternate; dur: 2000; loop: true"></a-sphere>

      <a-sphere position="0 3.5 0" radius="0.3" color="#FFD700" move-on-click animation="property: position; to: 0 4 0; dir: alternate; dur: 2000; loop: true"></a-sphere>

      <a-sphere position="0 3.5 -8" radius="0.3" color="#FFD700" move-on-click animation="property: position; to: 0 4 -8; dir: alternate; dur: 2000; loop: true"></a-sphere>
      
      <a-sphere position="0 3.5 -16" radius="0.3" color="#FFD700" move-on-click animation="property: position; to: 0 4 -16; dir: alternate; dur: 2000; loop: true"></a-sphere>

      <a-sphere position="0 3.5 -24" radius="0.3" color="#FFD700" move-on-click animation="property: position; to: 0 4 -24; dir: alternate; dur: 2000; loop: true"></a-sphere>

      <a-sphere position="0 3.5 -30" radius="0.3" color="#FFD700" move-on-click animation="property: position; to: 0 4 -30; dir: alternate; dur: 2000; loop: true"></a-sphere>

      <a-box position="-3.5 6 0" width="1.5" depth="1.5" height="12" color="#4cc3d9" distance-check>
        <a-sound src="#sound-crowd" autoplay="true" loop="true" volume="0.5" refDistance="3"></a-sound>
        <a-entity position="0 -1 1" class="hologram" visible="false">
            <a-plane width="3.2" height="1.2" color="#000" opacity="0.8"></a-plane>
            <a-text value="MEDICAL\n1156 Etudiants" align="center" color="#00ffff" width="6"></a-text>
        </a-entity>
      </a-box>

      <a-box position="3.5 4.5 0" width="1.5" depth="1.5" height="9" color="#FFC65D" distance-check>
        <a-sound src="#sound-crowd" autoplay="true" loop="true" volume="0.5" refDistance="3"></a-sound>
        <a-entity position="0 0.5 1" class="hologram" visible="false">
            <a-plane width="3.2" height="1.2" color="#000" opacity="0.8"></a-plane>
            <a-text value="COMMERCE\n940 Etudiants" align="center" color="#FFC65D" width="6"></a-text>
        </a-entity>
      </a-box>

      <a-box position="-3.5 2.5 -8" width="1.2" depth="1.2" height="5" color="#7BC8A4" distance-check>
        <a-sound src="#sound-crowd" autoplay="true" loop="true" volume="0.5" refDistance="2"></a-sound>
        <a-entity position="0 2 0.8" class="hologram" visible="false">
            <a-plane width="3" height="1" color="#000" opacity="0.8"></a-plane>
            <a-text value="NUMERIQUE\n484 Etudiants" align="center" color="#7BC8A4" width="5"></a-text>
        </a-entity>
      </a-box>

      <a-box position="-3.5 0.5 -24" width="1" depth="1" height="1" color="#F16745" distance-check>
        <a-entity position="0 4 0" class="hologram" visible="false">
            <a-plane width="2.5" height="0.8" color="#000" opacity="0.8"></a-plane>
            <a-text value="TOURISME\n76 Etudiants" align="center" color="#F16745" width="4"></a-text>
        </a-entity>
      </a-box>

      <a-box position="-3.5 0.25 -16" width="0.8" depth="0.8" height="0.5" color="#D7263D" distance-check>
        <a-entity position="0 4.5 0" class="hologram" visible="false">
            <a-plane width="2.5" height="0.8" color="#000" opacity="0.8"></a-plane>
            <a-text value="ART\n17 Etudiants" align="center" color="#D7263D" width="4"></a-text>
        </a-entity>
      </a-box>

      <a-box position="3.5 0.1 -24" width="0.5" depth="0.5" height="0.2" color="#8E44AD" distance-check>
         <a-entity position="0 4.5 0" class="hologram" visible="false">
            <a-plane width="2.5" height="0.8" color="#000" opacity="0.8"></a-plane>
            <a-text value="LOGISTIQUE\n9 Etudiants (0%)" align="center" color="#8E44AD" width="4"></a-text>
        </a-entity>
      </a-box>

      <a-box position="3.5 2 -8" width="1" depth="1" height="4" color="#333" distance-check>
         <a-entity position="0 2.5 0.6" class="hologram" visible="false">
            <a-plane width="2.5" height="0.8" color="#000" opacity="0.8"></a-plane>
            <a-text value="DROIT\n300 Etudiants" align="center" color="#FFF" width="4"></a-text>
        </a-entity>
      </a-box>

      <a-box position="3.5 1 -16" width="1" depth="1" height="2" color="#333" distance-check>
         <a-entity position="0 3.5 0.6" class="hologram" visible="false">
            <a-plane width="2.5" height="0.8" color="#000" opacity="0.8"></a-plane>
            <a-text value="SPORT\n150 Etudiants" align="center" color="#FFF" width="4"></a-text>
        </a-entity>
      </a-box>

      <a-box position="0 0.5 -32" width="1" depth="1" height="1" color="#333" distance-check>
         <a-entity position="0 4 0" class="hologram" visible="false">
            <a-plane width="2.5" height="0.8" color="#000" opacity="0.8"></a-plane>
            <a-text value="LANGUES\n80 Etudiants" align="center" color="#FFF" width="4"></a-text>
        </a-entity>
      </a-box>

    </a-scene>
</body>
</html>